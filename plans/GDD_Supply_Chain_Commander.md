# 《供应链指挥官：算法都市》
## Supply Chain Commander: Algo-City
### 游戏设计规范文档 (Game Design Document)

---

**版本:** 1.0  
**日期:** 2026年1月  
**状态:** 初稿  

---

## 文档目录

1. [游戏概述与愿景](#第一章-游戏概述与愿景)
2. [核心玩法循环与机制](#第二章-核心玩法循环与机制)
3. [生产系统设计](#第三章-生产系统设计)
4. [市场与供应链系统](#第四章-市场与供应链系统)
5. [需求组与动态替代机制](#第五章-需求组与动态替代机制)
6. [AI竞争对手系统](#第六章-ai竞争对手系统)
7. [科技研发系统](#第七章-科技研发系统)
8. [UI/UX设计规范](#第八章-uiux设计规范)
9. [LLM集成架构](#第九章-llm集成架构)
10. [游戏循环与终局设计](#第十章-游戏循环与终局设计)
11. [附录](#附录)

---

# 第一章 游戏概述与愿景

## 1.1 游戏简介

《供应链指挥官：算法都市》是一款融合宏观经济模拟、LLM驱动的动态市场系统以及商业策略的沙盒经营游戏。玩家扮演一家新兴企业的CEO，在一个由AI驱动的城市经济体中，通过战略决策而非微观操作来建立商业帝国。

### 核心定位
- **类型:** 经济模拟 / 商业策略 / 沙盒经营
- **平台:** PC (Windows/Mac/Linux)
- **目标受众:** 策略游戏爱好者、《维多利亚3》《工业大亨》等经济模拟游戏玩家
- **游戏时长:** 单局 20-50 小时

## 1.2 核心愿景声明

> "在这里，你不是在车间里移动机器——你是在驾驭市场的洪流。每一个决策都是蝴蝶效应的起点，而AI驱动的世界会用你从未想象过的方式回应你。"

### 设计支柱 (Design Pillars)

| 支柱 | 描述 |
|------|------|
| **宏观视角** | 玩家操作"建筑/公司"级别，而非"机器"级别。战略高于战术 |
| **动态涌现** | LLM驱动的市场事件、商品替代、消费趋势创造不可预测的涌现性叙事 |
| **系统深度** | 复杂但可读的经济系统，奖励深度理解和长期规划 |
| **有意义的对抗** | AI竞争对手拥有独特人格，创造情感投入的商业博弈 |

## 1.3 独特卖点 (USP)

1. **LLM驱动的动态经济** - 市场趋势、商品替代关系由AI实时生成，非预设脚本
2. **维多利亚式生产方式系统** - 通过下拉菜单切换生产逻辑，而非建造机器
3. **自然语言商业交互** - 与AI对手进行真实的商业谈判和舆论战
4. **涌现式科技系统** - 玩家通过自然语言描述发明新科技，结果由LLM生成

## 1.4 参考作品

| 游戏 | 借鉴元素 |
|------|----------|
| **维多利亚3** | 生产方式系统、POPs需求机制、宏观经济视角 |
| **工业大亨** | 产业链概念、商业竞争 |
| **银河文明4** | AI人格系统、外交互动 |
| **Cultist Simulator** | 模糊信息系统、文字驱动的推理 |

## 1.5 美术风格定位

- **整体风格:** 霓虹赛博朋克 × 金融科技极简主义
- **色彩方案:** 深色背景 + 霓虹强调色（青色、品红、琥珀色）
- **地图风格:** 低多边形 (Low-poly) 城市 + 数据流光效
- **UI风格:** 玻璃态 (Glassmorphism) + 全息投影元素

---

# 第二章 核心玩法循环与机制

## 2.1 核心循环概述

```
┌─────────────────────────────────────────────────────────────────┐
│                        核心玩法循环                               │
│                                                                   │
│   ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐  │
│   │  信息收集  │ -> │  战略决策  │ -> │  执行调整  │ -> │  观察结果  │  │
│   └──────────┘    └──────────┘    └──────────┘    └──────────┘  │
│        ↑                                                    │     │
│        └────────────────────────────────────────────────────┘     │
│                                                                   │
│   时间流速: 可暂停 / 1x / 2x / 4x                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 循环阶段详解

| 阶段 | 玩家行为 | 系统反馈 |
|------|----------|----------|
| **信息收集** | 阅读LLM生成的市场报告、情报分析、竞争对手动向 | 右侧情报流持续更新 |
| **战略决策** | 切换生产方式、签订合同、调整定价、启动研发 | 预测系统显示潜在影响 |
| **执行调整** | 确认操作、批量应用变更 | 动画反馈、资源消耗 |
| **观察结果** | 监控利润变化、市场份额、供应链状态 | 仪表盘实时更新 |

## 2.2 时间系统

### 游戏内时间
- **基础单位:** 1 游戏日 ≈ 3 现实秒 (1x速度)
- **财务周期:** 月结算 (30 游戏日)
- **合同周期:** 季度 / 年度
- **科技研发:** 以"月"为单位

### 时间控制
- **暂停:** 允许在暂停时做所有决策
- **速度选项:** 1x / 2x / 4x / 事件自动暂停

## 2.3 资源体系

### 一级资源 (战略资源)

| 资源 | 描述 | 获取方式 |
|------|------|----------|
| **资金** | 核心货币，用于一切交易 | 销售产品、贷款、投资收益 |
| **信誉** | 影响贷款利率、合同谈判、人才招募 | 履行合同、市场表现、公关活动 |
| **影响力** | 用于政治游说、舆论操作、行业标准制定 | 市场份额、媒体投放、行业地位 |

### 二级资源 (运营资源)

| 资源 | 描述 | 消耗场景 |
|------|------|----------|
| **算力** | AI辅助生产的必需品 | AI制造模式、数据分析 |
| **电力** | 基础工业消耗品 | 所有生产活动 |
| **劳动力** | 人力资源池 | 手工/流水线生产 |
| **仓储容量** | 库存上限 | 原料和成品存储 |

## 2.4 胜负条件

### 胜利条件 (可配置)

| 条件类型 | 描述 |
|----------|------|
| **经济霸权** | 控制城市 GDP 的 40% 以上 |
| **技术奇点** | 第一个研发出"终极科技"（如通用AI、可控核聚变） |
| **市场垄断** | 在 3 个以上行业达到 60%+ 市场份额 |
| **沙盒模式** | 无胜利条件，自由游玩 |

### 失败条件

| 条件 | 触发 |
|------|------|
| **破产** | 资金持续为负超过 3 个月且无法获得贷款 |
| **信誉崩塌** | 信誉降至 0 导致无法进行任何商业活动 |
| **被收购** | 股价跌至某阈值以下被竞争对手恶意收购 |

---

# 第三章 生产系统设计

## 3.1 建筑即节点理念

在本游戏中，玩家不进入工厂内部布置生产线。每一个**建筑**都是一个**黑箱节点**，玩家只关心其输入/输出配置。

### 建筑属性表

| 属性 | 描述 | 示例 |
|------|------|------|
| **类型** | 决定可切换的生产方式池 | 轻工业厂房、重工业厂房、数据中心 |
| **最大吞吐量** | 每月最大产能上限 | 10,000 单位/月 |
| **维护成本** | 固定月支出 | $50,000/月 |
| **地段优势** | 影响物流成本 | 港口区: 进口运费-20% |
| **升级槽位** | 可安装的增强模块数量 | 3 个槽位 |

### 建筑获取方式

1. **购买:** 一次性大额支出，完全所有权
2. **租赁:** 月付租金，灵活但长期成本高
3. **收购:** 收购拥有建筑的竞争对手公司
4. **建造:** 选址后等待建设周期（未来版本）

## 3.2 生产方式系统 (Production Methods)

这是本游戏的核心策略系统。每个工厂有 3-4 个**槽位**，每个槽位提供下拉菜单选择。

### 标准槽位结构

```
┌─────────────────────────────────────────────────────────────┐
│                    工厂生产配置面板                           │
├─────────────────────────────────────────────────────────────┤
│  槽位 1: 基础工艺                                            │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ [下拉菜单] 手工组装 / 流水线生产 / AI辅助制造         │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                              │
│  槽位 2: 自动化等级                                          │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ [下拉菜单] 无自动化 / 传感器监控 / 全自动黑灯工厂      │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                              │
│  槽位 3: 质量控制                                            │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ [下拉菜单] 抽检模式 / 全检模式 / AI视觉检测           │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                              │
│  槽位 4: 能源供给                                            │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ [下拉菜单] 市电供应 / 自备柴油机 / 绿电专供           │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

## 3.3 生产方式详细设计

### 槽位 1: 基础工艺

| 选项 | 输入需求 | 输出效果 | 适用场景 |
|------|----------|----------|----------|
| **手工组装** | 劳动力 ×3, 零件 ×1 | 产能 40%, 良品率 98% | 劳动力便宜时 |
| **流水线生产** | 电力 ×2, 零件 ×2, 劳动力 ×1 | 产能 100%, 良品率 95% | 标准选择 |
| **AI辅助制造** | 算力 ×3, 高级合金 ×1 | 产能 180%, 良品率 99% | 算力便宜时 |

### 槽位 2: 自动化等级

| 选项 | 效果 | 维护需求 |
|------|------|----------|
| **无自动化** | 劳动力需求 ×1.0 | 无额外消耗 |
| **传感器监控** | 劳动力需求 ×0.7, 事故率 -50% | 芯片 ×0.5/月 |
| **全自动黑灯工厂** | 劳动力需求 ×0.1, 产能 +20% | 芯片 ×2/月, 软件授权费 |

### 槽位 3: 质量控制

| 选项 | 良品率修正 | 成本影响 |
|------|------------|----------|
| **抽检模式** | -2% 良品率 | 无额外成本 |
| **全检模式** | +1% 良品率 | 劳动力 +10% |
| **AI视觉检测** | +3% 良品率 | 算力 +1/月 |

### 槽位 4: 能源供给

| 选项 | 成本 | 特殊效果 |
|------|------|----------|
| **市电供应** | 标准电价 | 受电网波动影响 |
| **自备柴油机** | 电价 ×1.5 | 不受停电影响 |
| **绿电专供** | 电价 ×1.2 | 获得 [环保] 标签加成 |

## 3.4 批量操作系统

玩家可以选择多个同类型工厂，**一键切换**所有工厂的生产方式。

### 批量操作界面

```
┌─────────────────────────────────────────────────────────────┐
│  批量配置 - 已选择 12 个轻工业厂房                           │
├─────────────────────────────────────────────────────────────┤
│  [全选同类] [按区域选择] [按盈利状态选择]                     │
│                                                              │
│  应用配置:                                                   │
│  ┌───────────────────────────────────────────────────────┐ │
│  │ 将所有选中工厂的 [基础工艺] 改为 [AI辅助制造]          │ │
│  └───────────────────────────────────────────────────────┘ │
│                                                              │
│  预计影响:                                                   │
│  • 总劳动力需求: 12,000 → 2,400 (-80%)                      │
│  • 总算力需求: 0 → 36/月 (+36)                              │
│  • 预计产能: +80%                                            │
│  • 预计月成本变化: +$120,000                                 │
│                                                              │
│  [取消] [应用变更]                                           │
└─────────────────────────────────────────────────────────────┘
```

## 3.5 产品配方系统 (Bill of Materials - BOM)

每种产品有一个配方表，定义所需原料和比例。玩家可通过研发创建新配方。

### 配方示例：标准功能饮料

| 原料 | 数量/单位产品 | 替代选项 |
|------|---------------|----------|
| 净化水 | 0.8 升 | 无 |
| 工业糖 | 50 克 | 代糖 (需研发) |
| 咖啡因提取物 | 30 毫克 | 瓜拉纳提取物 |
| 塑料瓶 | 1 个 | 铝罐, 玻璃瓶 |
| 防腐剂 | 5 克 | 无 (保质期-70%) |

### 配方修改机制

1. 玩家进入**产品实验室**
2. 选择现有产品或创建新产品
3. 调整原料组合
4. LLM 评估新配方的市场接受度和生产可行性
5. 生成新产品卡带有相应标签

---

# 第四章 市场与供应链系统

## 4.1 合同驱动的供应链

本游戏不模拟卡车运输路线。产业链连接通过**合同系统**实现。

### 合同类型

| 类型 | 描述 | 优劣势 |
|------|------|--------|
| **现货市场** | 即时买卖，按当前市价成交 | 灵活但价格波动大 |
| **短期合同** | 1-3个月固定价格供货 | 中等稳定性 |
| **长期协议** | 6-24个月锁价合作 | 价格稳定但缺乏灵活性 |
| **排他协议** | 供应商只供应你一家 | 完全控制但溢价高 |

### 合同条款模板

```
┌─────────────────────────────────────────────────────────────┐
│                    长期供货协议草案                          │
├─────────────────────────────────────────────────────────────┤
│  供应商: 铁拳重工 (AI)                                       │
│  商品: 标准钢材                                              │
│  数量: 1,000 吨/月                                           │
│  单价: $500/吨 (锁定)                                        │
│  期限: 12 个月                                               │
│  违约金: 合同总额的 15%                                      │
├─────────────────────────────────────────────────────────────┤
│  特殊条款:                                                   │
│  □ 价格与铁矿石指数挂钩 (浮动±10%)                          │
│  ☑ 提前终止需提前 30 天通知                                  │
│  □ 供应商承担运费                                            │
├─────────────────────────────────────────────────────────────┤
│  [拒绝] [修改条款] [接受并签署]                              │
└─────────────────────────────────────────────────────────────┘
```

## 4.2 B2B 交易市场

### 市场界面结构

```
┌─────────────────────────────────────────────────────────────┐
│  B2B 交易市场 - 钢材                                         │
├─────────────────────────────────────────────────────────────┤
│  当前价格: $520/吨  ▲ +4.2% (本周)                          │
│  24小时交易量: 15,000 吨                                     │
│                                                              │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ [价格走势图 - 30天]                                   │   │
│  │     ^                                                 │   │
│  │ $550│    ╱╲                                          │   │
│  │     │   ╱  ╲    ╱\                                   │   │
│  │ $500│──╱────╲──╱──\──────                            │   │
│  │     │ ╱      ╲╱    \                                 │   │
│  │ $450│╱                                               │   │
│  │     └────────────────────────────────────────────>   │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                              │
│  卖方挂单:                买方挂单:                          │
│  铁拳重工 500吨@$518     你的公司 300吨@$515                 │
│  钢城集团 800吨@$525     星辰电子 200吨@$510                 │
│                                                              │
│  [买入现货] [卖出现货] [挂买单] [挂卖单] [发起长约谈判]       │
└─────────────────────────────────────────────────────────────┘
```

## 4.3 LLM 驱动的谈判系统

当与AI供应商签订长约时，进入谈判模式。

### 谈判界面

```
┌─────────────────────────────────────────────────────────────┐
│  谈判对话 - 铁拳重工 CEO                                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│                                                              │
│  [AI头像] 铁拳重工 CEO:                                      │
│  "长期合作我们可以考虑，但 $500/吨的价格太低了。根据我们      │
│   掌握的信息，下个季度铁矿石还要涨价。$550 是我们的底线。"    │
│                                                              │
│  ─────────────────────────────────────────────────────────  │
│                                                              │
│  [玩家输入框]                                                │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 我可以保证每月采购量提升到 1500 吨，这个规模应该值    │   │
│  │ 一个更好的价格。另外，我们在城东的发电厂可以给你们    │   │
│  │ 优惠电价，这对你们的电炉炼钢有帮助。                  │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                              │
│  [发送] [退出谈判]                                           │
│                                                              │
│  ───── 谈判状态 ─────                                       │
│  对方情绪: ██████░░░░ (中性偏正)                             │
│  成交概率: 45%                                               │
│  己方筹码: 采购量, 电力供应                                   │
│  对方顾虑: 原料成本上涨, 产能紧张                            │
└─────────────────────────────────────────────────────────────┘
```

### 谈判变量

| 变量 | 影响 |
|------|------|
| **历史关系** | 过往合作愉快则AI更配合 |
| **市场地位** | 你是大客户则有议价权 |
| **市场预期** | LLM基于事件预测价格走势 |
| **替代选项** | 如果你有其他供应商，AI会更灵活 |
| **人格特质** | "垄断者"人格的AI更强硬 |

## 4.4 物流与仓储

虽然不微操运输，但物流成本仍然存在。

### 物流成本计算

```
运输成本 = 基础运费 × 距离系数 × 商品重量系数

距离系数:
- 同区域: ×1.0
- 相邻区域: ×1.5
- 跨区域: ×2.0
- 进口: ×3.0 + 关税

特殊修正:
- 港口区建筑: 进口运费 -30%
- 铁路沿线: 国内运费 -20%
- 拥堵区域: 运费 +25%
```

### 仓储系统

| 仓储类型 | 容量 | 月成本 | 特殊效果 |
|----------|------|--------|----------|
| 厂内仓库 | 小 | 含在建筑成本中 | 无 |
| 公共仓库 | 中 | $10/立方米 | 可临时扩展 |
| 冷链仓库 | 小 | $50/立方米 | 适用易腐商品 |
| 保税仓库 | 大 | $15/立方米 | 延迟缴纳关税 |

---

# 第五章 需求组与动态替代机制

## 5.1 POPs 需求系统

借鉴维多利亚3的理念，城市人群(POPs)不直接购买商品，而是购买**需求满足**。

### 需求组定义

| 需求组 | 描述 | 刚需程度 |
|--------|------|----------|
| **基础代谢** | 食物、饮用水、基础药品 | 高 - 必须满足 |
| **精神刺激** | 咖啡因、烟草、娱乐、游戏 | 中 - 强烈偏好 |
| **社会地位** | 奢侈品、高端服务、品牌商品 | 低 - 可选 |
| **出行效率** | 交通工具、通勤服务 | 中 - 视职业而定 |
| **居住品质** | 家居用品、装修材料 | 中 |
| **信息获取** | 电子设备、网络服务 | 中高 |
| **健康安全** | 医疗服务、保险、健身 | 中 |

## 5.2 效用值系统

每种商品对特定需求组有一个基础效用分数。

### 效用值示例：精神刺激需求

| 商品 | 基础效用 | 成瘾性 | 健康影响 |
|------|----------|--------|----------|
| 咖啡 | 10 | 低 | 中性 |
| 茶 | 8 | 无 | 正面 |
| 功能饮料 | 12 | 中 | 负面 |
| 电子游戏 | 15 | 高 | 中性 |
| VR娱乐 | 18 | 高 | 负面 |
| 香薰精油 | 5 | 无 | 正面 |

### 购买权重公式

$$购买权重 = \frac{效用值 \times 商品质量}{价格} \times 流行度修正_{LLM} \times 可及性$$

其中:
- **效用值:** 基础数值，可被LLM事件修改
- **商品质量:** 0.5-1.5，由生产配置决定
- **价格:** 市场售价
- **流行度修正:** LLM实时调整的系数 (0.1-3.0)
- **可及性:** 是否有库存、是否有销售渠道

## 5.3 LLM 驱动的动态替代

这是游戏的核心创新机制。LLM不仅生成文本，还**实时修改商品标签和效用值**。

### 标签系统 (Tag System)

每个商品拥有一组标签，影响其市场表现:

| 标签类型 | 示例 | 效果 |
|----------|------|------|
| **品类标签** | [饮料], [电子产品] | 决定归属需求组 |
| **品质标签** | [高端], [经济型] | 影响目标客户群 |
| **情感标签** | [时尚], [复古], [健康] | LLM可动态增删 |
| **负面标签** | [高压象征], [污染产品] | 降低购买意愿 |

### 动态替代事件流程

```
┌─────────────────────────────────────────────────────────────┐
│                    动态替代事件流程                          │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  1. 触发条件检测                                             │
│     ├─ 城市压力指数 > 阈值                                   │
│     ├─ 某商品市场份额异常                                    │
│     └─ 随机事件触发                                          │
│                          ↓                                   │
│  2. LLM 生成事件                                             │
│     ├─ 分析当前市场数据                                      │
│     ├─ 生成有因果逻辑的新闻/趋势                             │
│     └─ 输出事件文本 + 标签修改指令                           │
│                          ↓                                   │
│  3. 系统执行修改                                             │
│     ├─ 更新商品标签                                          │
│     ├─ 调整效用值                                            │
│     └─ 可能将商品移入/移出需求组                             │
│                          ↓                                   │
│  4. 市场反应                                                 │
│     ├─ 需求曲线变化                                          │
│     ├─ 价格波动                                              │
│     └─ 供应链连锁反应                                        │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 事件示例：养生热潮

**触发:** 城市"压力值"连续3个月超过阈值

**LLM生成事件:**
> 📰 **爆款文章席卷社交网络**
> 
> 《内卷致死：那些被功能饮料摧毁的年轻人》一文在全城疯传。文章以详实的案例揭示了过度工作文化对健康的危害，引发了一场"反内卷"运动。人们开始重新审视自己的消费选择...

**系统执行:**

| 商品 | 标签变化 | 效用值变化 |
|------|----------|------------|
| 功能饮料 | +[负面:高压象征] | 12 → 5 |
| 茶 | +[正面:松弛感] | 8 → 15 |
| 咖啡 | 无变化 | 10 → 10 |
| 香薰精油 | 进入[精神刺激]需求组 | 0 → 12 |

## 5.4 供应链连锁反应 (牛鞭效应)

替代机制会向上游传导:

```
下游变化                      中游冲击                      上游影响
    │                            │                            │
    ▼                            ▼                            ▼
┌─────────┐               ┌─────────┐               ┌─────────┐
│功能饮料 │──需求暴跌──→ │咖啡因   │──订单消失──→ │化工糖   │
│ 滞销   │               │提取厂   │               │价格暴跌│
└─────────┘               │危机     │               └─────────┘
                          └─────────┘                     │
┌─────────┐               ┌─────────┐                     │
│ 茶饮料  │──需求暴涨──→ │茶叶加工 │               ┌─────────┐
│ 畅销   │               │扩产     │               │农产品  │
└─────────┘               └─────────┘               │价格上涨│
                                                    └─────────┘
```

## 5.5 玩家应对策略

### 产品重定义流程

1. **检测危机:** 通过情报流发现销量下跌
2. **分析原因:** LLM助理解释标签变化
3. **调整配方:** 在产品实验室修改BOM
4. **营销重塑:** 输入新的营销Prompt
5. **等待判定:** LLM评估是否成功获得新标签

### 营销重塑Prompt示例

**玩家输入:**
> "将我们的功能饮料重新定位为'草本轻能量水'，强调它是为身体充电而非透支，主打运动后恢复场景，包装改用绿色系。"

**LLM判定逻辑:**
1. 检查配方是否支持宣称 (是否真的含草本成分?)
2. 检查营销预算是否足够
3. 检查市场是否有类似定位的竞品
4. 输出成功/失败结果及原因

---

# 第六章 AI竞争对手系统

## 6.1 AI 架构设计

每个竞争对手是一个独立的**LLM Agent**，采用**GOAP + LLM混合架构**。

### 双层架构

```
┌─────────────────────────────────────────────────────────────┐
│                    AI 竞争对手架构                           │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              LLM 层 (感性灵魂)                       │   │
│  │  • 生成对话文本和谈判策略                            │   │
│  │  • 决定行动的"风格"和"语气"                         │   │
│  │  • 基于人格特质进行参数微调                          │   │
│  │  • 生成行动的"理由"和"威胁"                         │   │
│  └─────────────────────────────────────────────────────┘   │
│                          ↑ ↓                                │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              GOAP 层 (理性大脑)                      │   │
│  │  • 设定战略目标 (Goal)                               │   │
│  │  • 计算最优行动路径                                   │   │
│  │  • 资源管理和风险评估                                 │   │
│  │  • 防止LLM做出完全不合逻辑的决策                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

## 6.2 AI 人格原型 (Archetypes)

### 激进的垄断者 (The Monopolist)

| 属性 | 设定 |
|------|------|
| **核心动机** | 控制市场，消灭竞争 |
| **风险偏好** | 高 |
| **LLM指令** | "尽一切可能获取市场份额，不惜短期亏损。优先控制上游原材料。" |
| **典型行为** | 价格战、囤积原料、恶意收购 |
| **弱点** | 忽视利润，可能资金链断裂 |

### 趋势追逐者 (The Trend Surfer)

| 属性 | 设定 |
|------|------|
| **核心动机** | 追逐热点，快速获利 |
| **风险偏好** | 中高 |
| **LLM指令** | "紧盯市场热度，什么标签火就生产什么。快速切换产线。" |
| **典型行为** | 频繁切换产品线，大量投放广告 |
| **弱点** | 缺乏长期积累，品牌忠诚度低 |

### 旧日贵族 (The Old Money)

| 属性 | 设定 |
|------|------|
| **核心动机** | 维持声誉，稳健经营 |
| **风险偏好** | 低 |
| **LLM指令** | "维持高利润率，只做高端产品，拒绝低端价格战。" |
| **典型行为** | 高定价，注重质量，长期合同偏好 |
| **弱点** | 适应市场变化慢 |

### 技术狂人 (The Tech Evangelist)

| 属性 | 设定 |
|------|------|
| **核心动机** | 技术领先，改变世界 |
| **风险偏好** | 中 |
| **LLM指令** | "投资研发，追求技术突破。愿意为长期技术优势牺牲短期利润。" |
| **典型行为** | 大量研发投入，申请专利，技术授权 |
| **弱点** | 可能在错误的技术路线上投入过多 |

## 6.3 记忆系统 (Memory System)

AI会记住与玩家的所有交互历史。

### 记忆类型

| 类型 | 存储内容 | 影响 |
|------|----------|------|
| **交易记忆** | 合同履行情况 | 影响信任度 |
| **冲突记忆** | 价格战、舆论攻击 | 影响敌意值 |
| **合作记忆** | 成功的合作案例 | 增加好感度 |
| **背叛记忆** | 毁约、恶意收购 | 长期敌对 |

### 关系影响示例

```
┌─────────────────────────────────────────────────────────────┐
│  关系面板 - 铁拳重工                                         │
├─────────────────────────────────────────────────────────────┤
│  关系状态: ████████░░ 敌对 (-65)                            │
│                                                              │
│  历史事件:                                                   │
│  • [去年3月] 你在他们资金紧张时恶意收购了他们的子公司 (-50)   │
│  • [去年6月] 你发起了针对他们钢材质量的舆论攻击 (-20)         │
│  • [今年1月] 你们签订了一份电力供应合同 (+5)                  │
│                                                              │
│  AI 内部状态 (玩家不可见):                                   │
│  "这个玩家是危险的。任何时候有机会报复，我都会采取行动。      │
│   优先考虑与他的竞争对手合作。"                              │
└─────────────────────────────────────────────────────────────┘
```

## 6.4 竞争行为设计

### 供应链封锁 (Supply Choke)

**触发条件:** AI检测到玩家对某原料依赖度高

**执行步骤:**
1. GOAP层识别机会
2. AI大量购入该原料期货
3. 原料价格上涨
4. 玩家成本失控

**玩家反制:**
- 谈判购买AI库存
- 研发替代材料
- 反垄断投诉

### 标签抢夺战 (Tag Hijacking)

**触发条件:** 玩家产品拥有高价值标签

**执行步骤:**
1. AI投放大量针对性广告
2. LLM生成市场营销文案
3. 尝试将标签从玩家产品转移到AI产品

**玩家反制:**
- 增加营销投入
- 产品升级强化标签
- 舆论反击

### 人才挖角 (Talent Poaching)

**触发条件:** 玩家拥有高能力员工

**执行步骤:**
1. AI生成挖角邮件 (由LLM撰写)
2. 员工考虑跳槽
3. 玩家需决定是否加薪

**玩家反制:**
- 加薪挽留
- 签订竞业禁止条款
- 用愿景说服 (LLM撰写挽留信)

## 6.5 资本运作系统 (M&A)

### 股票市场

每家公司有股票价格，由以下因素决定:
- 当前利润率
- LLM生成的未来预期
- 市场情绪

### 恶意收购流程

```
┌─────────────────────────────────────────────────────────────┐
│                    恶意收购流程                              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  1. 发起方                                                   │
│     ├─ 判断目标公司股价是否足够低                            │
│     ├─ 准备收购资金                                          │
│     └─ 发起公开要约                                          │
│                          ↓                                   │
│  2. 目标公司防御                                             │
│     ├─ 寻找白衣骑士 (友好收购方)                             │
│     ├─ 启动毒丸计划 (大量增发股份稀释)                       │
│     ├─ 突击分红 (降低公司价值)                               │
│     └─ 寻求政府干预                                          │
│                          ↓                                   │
│  3. 结果判定                                                 │
│     ├─ 收购成功: 获得目标公司控制权                          │
│     ├─ 收购失败: 损失要约成本                                │
│     └─ 协商和解: 收购部分资产                                │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 子公司管理

收购成功后，可以:
- **直接整合:** 并入母公司，获得其资产和生产线
- **保留自治:** AI继续担任CEO，给予宏观指令
- **出售拆分:** 拆分资产分别出售

---

# 第七章 科技研发系统

## 7.1 涌现式科技发明

本游戏没有预设科技树。科技由玩家通过自然语言描述创造。

### 研发流程

```
┌─────────────────────────────────────────────────────────────┐
│                    科技发明流程                              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  1. 概念提出                                                 │
│     └─ 玩家在研发实验室输入自然语言描述                      │
│        例: "我想研发基于海藻的生物燃料替代石油"               │
│                          ↓                                   │
│  2. 可行性评估                                               │
│     └─ LLM扮演首席科学家进行分析                            │
│        ├─ 可行性评级                                         │
│        ├─ 预估成本                                           │
│        ├─ 研发周期                                           │
│        └─ 前置技术需求                                       │
│                          ↓                                   │
│  3. 研发执行                                                 │
│     └─ 投入资金和资源                                        │
│        ├─ 进度条推进                                         │
│        ├─ 可能的随机事件 (突破/挫折)                         │
│        └─ 可追加投资加速                                     │
│                          ↓                                   │
│  4. 成果生成                                                 │
│     └─ LLM生成完整的技术卡片                                │
│        ├─ 技术名称和描述                                     │
│        ├─ 新生产方式配置                                     │
│        ├─ 副作用和风险                                       │
│        └─ 专利信息                                           │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

## 7.2 可行性评估系统

### 首席科学家界面

```
┌─────────────────────────────────────────────────────────────┐
│  研发概念验证 - 首席科学家评估                               │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  项目: 海藻生物燃油                                          │
│                                                              │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ [首席科学家头像]                                      │   │
│  │                                                        │   │
│  │ "这是一个有前景的方向。海藻作为生物质燃料的研究在     │   │
│  │  学术界已有基础。根据我的评估..."                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                              │
│  评估结果:                                                   │
│  ├─ 可行性: ████████░░ 较高 (75%)                           │
│  ├─ 预估预算: $50M - $80M                                    │
│  ├─ 研发周期: 8-14 个月                                      │
│  └─ 风险等级: 中等                                           │
│                                                              │
│  前置条件:                                                   │
│  ├─ ✓ 基础生物化学 (已拥有)                                 │
│  ├─ ✗ 高压发酵工艺 (需要先研发)                             │
│  └─ ✓ 藻类培养技术 (可从市场购买专利)                       │
│                                                              │
│  潜在风险:                                                   │
│  • 产量可能不稳定，受季节和水质影响                          │
│  • 可能产生有机废料，需要额外处理设施                        │
│                                                              │
│  [取消项目] [购买前置专利] [启动研发]                        │
└─────────────────────────────────────────────────────────────┘
```

## 7.3 技术卡片生成

研发成功后，LLM生成完整的技术规格。

### 技术卡片示例

```
┌─────────────────────────────────────────────────────────────┐
│  ═══════════════════════════════════════════════════════   │
│                    【蓝藻生物燃油工艺】                       │
│  ═══════════════════════════════════════════════════════   │
│                                                              │
│  类型: 能源 / 生产工艺                                       │
│  研发者: [玩家公司名]                                        │
│  专利有效期: 5 年                                            │
│                                                              │
│  ─────────────────────────────────────────────────────────  │
│  描述:                                                       │
│  一种利用基因改造蓝藻在光生物反应器中快速繁殖，并通过        │
│  热解工艺提取生物油的新型能源生产方式。                      │
│  ─────────────────────────────────────────────────────────  │
│                                                              │
│  解锁生产方式:                                               │
│  ┌───────────────────────────────────────────────────────┐ │
│  │ 【发电厂】新增选项: 生物燃油发电                        │ │
│  │  • 输入: 海藻 ×10, 水 ×5, 电力 ×1 (启动)               │ │
│  │  • 输出: 电力 ×8 (净产出7)                             │ │
│  │  • 副产物: 有机污泥 ×2                                 │ │
│  └───────────────────────────────────────────────────────┘ │
│                                                              │
│  市场标签: [可再生能源] [碳中和] [新技术]                    │
│                                                              │
│  ⚠ 副作用警告:                                               │
│  • 有机污泥如不妥善处理可能造成水体污染                      │
│  • 藻类培养需要大量淡水资源                                  │
│  • 存在藻类变异失控的小概率风险                              │
│                                                              │
│  [授权给他人] [独占使用] [出售专利]                          │
└─────────────────────────────────────────────────────────────┘
```

## 7.4 专利与技术博弈

### 专利系统

| 权利 | 描述 |
|------|------|
| **独占使用** | 5年内只有你能使用该技术 |
| **授权收费** | 允许他人使用，收取专利费 |
| **出售专利** | 一次性出售全部权利 |
| **专利诉讼** | 起诉侵权者 |

### 技术路线之争

当多个竞争技术路线并存时，市场会"选择"胜者。

**示例: 能源技术之争**

| 技术路线 | 支持方 | 优势 | 劣势 |
|----------|--------|------|------|
| 海藻生物油 | 玩家 | 成本低 | 有碳排放 |
| 小型核聚变 | AI对手 | 零排放 | 成本极高 |

**市场裁决机制:**
- LLM根据经济数据和社会事件生成政策变化
- 例如: "《零碳法案》通过" → 所有碳排放技术被禁止
- 玩家投资的技术路线可能被市场淘汰

## 7.5 技术的副作用 (灯神诅咒)

LLM在生成技术时会附加玩家未预见的副作用。

### 副作用类型

| 类型 | 示例 |
|------|------|
| **健康风险** | 新型食品添加剂6个月后发现致敏 |
| **环境影响** | 新材料不可降解，引发环保争议 |
| **社会影响** | 自动化技术导致大规模失业，引发抗议 |
| **技术依赖** | 需要持续购买某种稀缺原料 |

### Prompt措辞的重要性

玩家的研发描述越精确，副作用风险越低。

**模糊描述:**
> "我想要便宜的肉替代品"

**可能结果:**
> 昆虫蛋白压制肉 - 成本极低，但引发大规模过敏事件

**精确描述:**
> "我想要基于植物蛋白的肉替代品，必须通过过敏原测试，适合大规模生产"

**可能结果:**
> 大豆组织蛋白 - 成本中等，无重大副作用

## 7.6 科技星图 (Constellation View)

由于科技是非线性的，使用星图而非树状图展示。

### 星图设计

```
                              ★ 量子计算
                             ╱
                   ★ 光刻机 ─┤
                  ╱          ╲
         ★ 芯片设计            ★ AI意识
        ╱
★ 基础电子学 ─────── ★ 传感器技术
        ╲
         ★ 电池化学 ─┬─ ★ 固态电池
                     │
                     └─ ★ 氢燃料电池
                              ╲
                               ★ 清洁能源系统
                              ╱
              ★ 海藻生物油 ──┤
             ╱               ╲
★ 基础生化 ─┤                 ★ 碳捕获
             ╲
              ★ 基因编辑 ─── ★ 合成生物学
```

**星图规则:**
- 玩家/AI每发明一个技术，点亮一颗星
- 星与星之间的连线表示技术关联
- 未研发但可见的星显示为暗星 (技术方向提示)
- 完全未知的区域显示为迷雾

---

# 第八章 UI/UX设计规范

## 8.1 整体布局

采用"三栏式 + 底部控制台"布局。

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              顶部状态栏                                  │
├───────────┬──────────────────────────────────────────┬──────────────────┤
│           │                                          │                  │
│           │                                          │                  │
│  左侧栏    │              中央主视窗                  │    右侧情报流     │
│  导航菜单  │              城市地图/面板               │    LLM助理       │
│  15%      │              60%                         │    25%           │
│           │                                          │                  │
│           │                                          │                  │
├───────────┴──────────────────────────────────────────┴──────────────────┤
│                            底部控制台                                    │
│                     时间控制 / 宏观操作栏                                │
└─────────────────────────────────────────────────────────────────────────┘
```

## 8.2 左侧导航栏设计

### 组件结构

```
┌─────────────┐
│  [公司Logo] │
│  ━━━━━━━━━ │
│  $12.5M     │  ← 总资金
│  ▲ 股价$45  │  ← 股价动态
│  净利润+$2M │  ← 本月净利
├─────────────┤
│  📊 总览    │
│  🏭 实业    │  ← 展开显示工厂列表
│  📈 市场    │
│  🔬 研发    │
│  🤝 外交    │
│  ⚙️ 设置   │
├─────────────┤
│  资源简报   │
│  ⚡ 电力 82%│
│  📦 仓储 65%│
│  👥 劳动力OK│
└─────────────┘
```

## 8.3 中央主视窗设计

### 8.3.1 城市全息地图

**视觉风格:** 低多边形 + 霓虹线框

**节点系统:**
- 每个建筑是一个发光节点
- 节点大小 = 产能规模
- 节点颜色:
  - 🟢 绿色 = 盈利
  - 🔴 红色 = 亏损
  - 🟡 黄色 = 缺原料
  - ⚪ 白色 = 闲置

**连接线 (Flux Lines):**
- 节点之间的流动光线 = 合同关系
- 线粗细 = 交易量
- 线断裂 = 供应链中断警报

### 8.3.2 生产管理卡片

点击工厂节点弹出的悬浮卡片:

```
┌─────────────────────────────────────────────────────────────┐
│  城西工业区 - 轻工业厂房 #3                    [X]          │
├─────────────────────────────────────────────────────────────┤
│  状态: 运营中                     产能利用率: ████████░░ 82%│
│  月产值: $450,000                 月成本: $380,000           │
│  净利润: $70,000                  良品率: 96.5%              │
├─────────────────────────────────────────────────────────────┤
│  生产配置:                                                   │
│                                                              │
│  工艺:    [流水线生产 ▾]        自动化: [传感器监控 ▾]       │
│  质检:    [AI视觉检测 ▾]        能源:   [市电供应 ▾]         │
│                                                              │
│  ─────────────────────────────────────────────────────────  │
│  输入:                           输出:                       │
│  • 钢材 x100 ($50,000)           • 家用电器 x80 ($450,000)   │
│  • 塑料 x50  ($15,000)           • 废料 x20 (需处理)         │
│  • 电力 x200 ($40,000)                                       │
│  • 劳动力 x30                                                │
├─────────────────────────────────────────────────────────────┤
│  预测: 切换到 [AI辅助制造] 后...                             │
│  • 劳动力需求: 30 → 5 ▼                                     │
│  • 算力需求: 0 → 15 ▲                                       │
│  • 产能: +45%                                                │
│  • 月利润预计: +$25,000                                      │
├─────────────────────────────────────────────────────────────┤
│  [出售建筑] [升级改造] [批量应用配置]                        │
└─────────────────────────────────────────────────────────────┘
```

### 8.3.3 市场星系图 (力导向图)

**视觉逻辑:**
- 每个圆圈 = 一种商品
- 圆圈大小 = 市场需求量
- 圆圈距离 = 替代性 (近 = 高替代性)
- 圆圈颜色 = 需求组归属

**动态效果:**
- 当市场趋势变化时，圆圈会实时移动
- 新兴商品从边缘飞入
- 淘汰商品逐渐变暗消失

```
                    ┌─────────────────────────────────────────┐
                    │            精神刺激需求组               │
                    │                                         │
                    │        ◯ 电子游戏                       │
                    │       ╱                                 │
                    │  ◉ 咖啡 ─── ◉ 功能饮料                  │
                    │   │    ╲                                │
                    │   │     ◯ 茶 ◄── 正在变大               │
                    │   │                                     │
                    │  ◯ 烟草                                 │
                    │       ╲                                 │
                    │        ◯ 香薰 ◄── 新进入此需求组        │
                    │                                         │
                    └─────────────────────────────────────────┘
```

### 8.3.4 研发实验室界面

极简风格，类似代码编辑器。

```
┌─────────────────────────────────────────────────────────────┐
│  研发实验室                                                  │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  项目名称: [                                            ]    │
│                                                              │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                                                      │   │
│  │  描述你想发明的技术...                               │   │
│  │                                                      │   │
│  │  我想研发一种基于海藻的生物燃料，用来替代石油，      │   │
│  │  成本必须比石油低，但可以接受发电效率稍微低一点。    │   │
│  │                                                      │   │
│  │  _                                                   │   │
│  │                                                      │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                              │
│  ─────────────────────────────────────────────────────────  │
│  实时分析:                                                   │
│  ┌──────────────────────┐ ┌──────────────────────┐         │
│  │ 检测到关键词:         │ │ 风险评估:            │         │
│  │ • 海藻 (生物质)       │ │ ████░░░░░░ 中等     │         │
│  │ • 石油替代            │ │                      │         │
│  │ • 成本敏感            │ │ 预估成本:            │         │
│  │ • 效率可妥协          │ │ $50M - $80M          │         │
│  └──────────────────────┘ └──────────────────────┘         │
│                                                              │
│  [取消] [提交评估]                                           │
└─────────────────────────────────────────────────────────────┘
```

## 8.4 右侧情报流设计

### 组件结构

```
┌──────────────────┐
│  🔔 突发新闻      │
│  ━━━━━━━━━━━━━━ │
│  📰 热浪来袭!    │
│  冷饮需求暴涨... │
│  [展开详情]      │
│                  │
│  📰 反垄断调查   │
│  某芯片厂商...   │
├──────────────────┤
│  🤖 AI 助理      │
│  ━━━━━━━━━━━━━━ │
│  "根据市场数据   │
│  分析，本月钢材  │
│  价格预计上涨    │
│  5-8%..."        │
│                  │
│  [查看详细报告]  │
├──────────────────┤
│  💬 谈判窗口     │
│  ━━━━━━━━━━━━━━ │
│  (与铁拳重工的   │
│   对话显示在这里)│
│                  │
├──────────────────┤
│  ┌──────────────┐│
│  │ 输入指令...  ││
│  └──────────────┘│
│  [发送]          │
└──────────────────┘
```

### 谈判情绪光效

对话框边框颜色反映AI态度:
- 🔴 红色脉冲 = 强硬/敌对
- 🟡 黄色 = 中性/观望
- 🔵 蓝色呼吸 = 动摇/准备妥协
- 🟢 绿色 = 友好/同意

## 8.5 底部控制台

```
┌─────────────────────────────────────────────────────────────────────────┐
│  ⏸ [暂停] [1x] [2x] [4x] ▶                    📅 2045年3月15日 周三    │
│                                                                         │
│  市场状态: ████████░░ 动荡      全局定价: [自动] [+5%] [+10%] [-5%]    │
│                                                                         │
│  快捷操作: [批量切换生产方式] [发布全公司公告] [一键续约所有合同]        │
└─────────────────────────────────────────────────────────────────────────┘
```

## 8.6 交互微动效

### 连接线物理反馈
建立新贸易路线时:
- "插入插头"的吸附动画
- 厚重的机械音效
- 连接成功时的电流流动效果

### LLM文本生成方式
- 逐字打字机效果 (非瞬间出现)
- 轻微的机械键盘声
- 强调"情报正在解密"的沉浸感

### 合同签署动画
- 电子签名闪烁
- 合同卷轴收起效果
- 交易确认音效

---

# 第九章 LLM集成架构

## 9.1 整体架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           游戏客户端                                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌───────────────────┐  ┌───────────────────┐  ┌───────────────────┐  │
│  │    UI 渲染层      │  │    游戏逻辑层      │  │   数据存储层     │  │
│  │  (React/Unity)    │  │  (Core Engine)     │  │  (Local DB)      │  │
│  └─────────┬─────────┘  └─────────┬─────────┘  └─────────┬─────────┘  │
│            │                      │                      │            │
│            └──────────────────────┼──────────────────────┘            │
│                                   │                                    │
│                          ┌────────▼────────┐                           │
│                          │   LLM 接口层    │                           │
│                          │  (API Gateway)  │                           │
│                          └────────┬────────┘                           │
│                                   │                                    │
└───────────────────────────────────┼────────────────────────────────────┘
                                    │
                    ┌───────────────┼───────────────┐
                    │               │               │
           ┌────────▼───────┐ ┌────▼────┐ ┌───────▼──────┐
           │  云端 LLM API  │ │本地 LLM │ │  Fallback    │
           │ (GPT/Claude)   │ │(Llama)  │ │  (规则系统)  │
           └────────────────┘ └─────────┘ └──────────────┘
```

## 9.2 LLM 调用场景分类

### 高频调用 (需优化)

| 场景 | 频率 | 优化策略 |
|------|------|----------|
| AI助理市场分析 | 每游戏日 | 批量生成缓存 |
| 新闻滚动生成 | 每游戏周 | 预生成池 |
| 价格趋势描述 | 实时 | 模板填充 |

### 中频调用 (标准处理)

| 场景 | 频率 | 处理方式 |
|------|------|----------|
| 商业谈判对话 | 玩家触发 | 流式响应 |
| 市场事件生成 | 每游戏月 | 异步生成 |
| 竞争对手决策 | 每游戏周 | 后台批处理 |

### 低频调用 (高质量)

| 场景 | 频率 | 处理方式 |
|------|------|----------|
| 科技发明评估 | 玩家触发 | 多轮对话 |
| 重大剧情事件 | 稀有 | 长上下文 |
| 终局叙事生成 | 游戏结束 | 完整生成 |

## 9.3 Prompt 工程规范

### 系统提示词模板 (AI竞争对手)

```
你是一个名为"{company_name}"的公司的CEO，在城市经济模拟游戏中。

## 你的人格特质
{persona_description}

## 你的当前状态
- 资金: ${current_funds}
- 市场份额: {market_share}%
- 主营业务: {main_business}
- 与玩家关系: {relationship_score} ({relationship_description})

## 历史记忆
{memory_summary}

## 当前市场情况
{market_context}

## 你的行为准则
1. 始终保持人格一致性
2. 决策必须基于经济理性，但可带有人格色彩
3. 记住过去的交互，表现出记忆连贯性
4. 不要做出明显愚蠢的商业决策

## 当前任务
{current_task}
```

### 系统提示词模板 (市场事件生成)

```
你是一个城市经济模拟游戏的市场事件生成器。

## 当前市场数据
{market_data_json}

## 当前活跃标签
{active_tags}

## 触发条件
{trigger_condition}

## 输出格式
生成一个市场事件，包含以下JSON结构:
{
  "headline": "事件标题",
  "description": "详细描述 (50-100字)",
  "tag_changes": [
    {"product": "产品名", "add_tags": [], "remove_tags": [], "utility_change": 0}
  ],
  "duration": "持续时间 (短期/中期/长期)",
  "severity": "影响程度 (1-10)"
}

## 生成规则
1. 事件必须有因果逻辑
2. 标签变化必须合理 (不能让钢材突然获得"美食"标签)
3. 参考当前市场数据，不要生成与数据矛盾的事件
4. 控制影响范围，避免单一事件摧毁整个经济
```

## 9.4 输出约束与验证

### JSON Schema 验证

所有结构化输出必须通过Schema验证:

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "headline": {"type": "string", "maxLength": 50},
    "description": {"type": "string", "maxLength": 200},
    "tag_changes": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "product": {"type": "string"},
          "add_tags": {"type": "array", "items": {"type": "string"}},
          "remove_tags": {"type": "array", "items": {"type": "string"}},
          "utility_change": {"type": "integer", "minimum": -20, "maximum": 20}
        }
      }
    }
  }
}
```

### 安全边界

| 限制类型 | 规则 |
|----------|------|
| **经济影响** | 单一事件最多影响市场5%的商品 |
| **价格变动** | 单次变动不超过±30% |
| **标签转移** | 同类商品间才能转移标签 |
| **效用值变化** | 单次变化不超过±10 |

## 9.5 本地化与离线支持

### 分层策略

| 层级 | 在线 | 离线 |
|------|------|------|
| **核心对话** | 云端API | 本地LLM (精简) |
| **事件生成** | 云端API | 预生成库 + 模板 |
| **市场分析** | 云端API | 规则引擎 |
| **基础响应** | 云端API | 脚本库 |

### 离线事件库结构

```
/events
  /economy
    inflation_crisis.json
    trade_war.json
    tech_bubble.json
  /social
    labor_strike.json
    health_scare.json
  /environment
    pollution_scandal.json
    climate_policy.json
```

---

# 第十章 游戏循环与终局设计

## 10.1 游戏阶段

### 阶段划分

| 阶段 | 时间范围 | 核心挑战 | 解锁内容 |
|------|----------|----------|----------|
| **创业期** | 第1-12月 | 建立第一条盈利产线 | 基础生产方式 |
| **扩张期** | 第1-3年 | 进入多个行业 | 长期合同、研发 |
| **竞争期** | 第3-5年 | 应对AI对手攻击 | 资本运作、专利 |
| **霸权期** | 第5年+ | 塑造市场规则 | 终局科技、政治影响 |

## 10.2 难度曲线

```
难度
  │                                    ╱
  │                               ╱───╱
  │                          ╱───╱
  │                     ╱───╱
  │                ╱───╱     ← 竞争期开始
  │           ╱───╱              AI开始积极对抗
  │      ╱───╱
  │ ╱───╱
  │╱
  └──────────────────────────────────────────────→ 时间
      创业期      扩张期         竞争期        霸权期
```

## 10.3 终局事件：时代精神 (Zeitgeist)

随着科技积累，LLM会判定世界走向，触发终局叙事。

### 结局分支

#### 结局A: 赛博格黎明

**触发条件:** AI/机器人/脑机接口相关科技占主导

**世界状态:**
- 人类需求结构改变 (不再需要食物，只需电力)
- 传统产业消亡
- 意识上传成为新市场

**玩家影响:**
- 拥有电子/AI产业者成为新贵
- 传统行业玩家需要转型或破产

#### 结局B: 生态乌托邦

**触发条件:** 清洁能源/有机农业/可持续技术占主导

**世界状态:**
- 重工业被驱逐出城市
- 碳税极高
- 消费降级成为主流

**玩家影响:**
- 绿色产业玩家获胜
- 高污染产业面临强制关停

#### 结局C: 新封建时代

**触发条件:** 垄断程度极高，贫富分化严重

**世界状态:**
- 少数寡头控制一切
- 社会动荡
- 政府权力弱化

**玩家影响:**
- 垄断者玩家成为"领主"
- 中小玩家沦为附庸

#### 结局D: 废土危机

**触发条件:** 环境污染超标，未研发治理技术

**世界状态:**
- 城市环境崩溃
- 人口外迁
- 经济全面崩溃

**玩家影响:**
- 所有玩家失败
- 进入"末日生存"DLC内容

## 10.4 沙盒模式

无胜利条件，自由游玩:

| 选项 | 描述 |
|------|------|
| **无限资金启动** | 去除经济压力 |
| **禁用AI对手** | 专注建设 |
| **事件频率调节** | 控制市场波动 |
| **自定义规则** | 修改游戏参数 |

## 10.5 新游戏+

完成一局后解锁:

| 内容 | 描述 |
|------|------|
| **遗产点数** | 根据成就获得，用于下一局开局加成 |
| **隐藏人格** | 解锁新的AI对手类型 |
| **历史剧本** | 解锁特殊起始条件 |
| **终极科技蓝图** | 解锁上一局研发的独特科技 |

---

# 附录

## 附录A: 商品数据表模板

| ID | 商品名 | 类别 | 基础价格 | 需求组 | 基础效用 | 重量 | 保质期 |
|----|--------|------|----------|--------|----------|------|--------|
| 001 | 标准钢材 | 原料 | $500/吨 | - | - | 高 | 无限 |
| 002 | 咖啡 | 消费品 | $15/kg | 精神刺激 | 10 | 低 | 12月 |
| 003 | 功能饮料 | 消费品 | $3/瓶 | 精神刺激 | 12 | 低 | 6月 |

## 附录B: 生产方式平衡参数

### 基础工艺效率表

| 方式 | 劳动力系数 | 电力系数 | 算力系数 | 产能系数 | 良品率 |
|------|------------|----------|----------|----------|--------|
| 手工组装 | 3.0 | 0.5 | 0 | 0.4 | 0.98 |
| 流水线 | 1.0 | 2.0 | 0 | 1.0 | 0.95 |
| AI制造 | 0.2 | 1.5 | 3.0 | 1.8 | 0.99 |

## 附录C: AI人格参数表

| 人格 | 风险偏好 | 攻击性 | 合作意愿 | 价格敏感度 | 研发倾向 |
|------|----------|--------|----------|------------|----------|
| 垄断者 | 0.9 | 0.95 | 0.1 | 0.3 | 0.4 |
| 趋势者 | 0.7 | 0.4 | 0.6 | 0.8 | 0.6 |
| 贵族 | 0.2 | 0.3 | 0.7 | 0.2 | 0.5 |
| 技术狂 | 0.6 | 0.3 | 0.5 | 0.5 | 0.95 |

## 附录D: LLM Prompt 模板库

### 市场分析报告模板

```
基于以下数据生成市场分析报告:
{data}

要求:
1. 语气专业但易懂
2. 包含1-2个具体建议
3. 提及潜在风险
4. 不超过150字
```

### 谈判对话模板

```
你是{company}的CEO。
当前关系: {relationship}
对方提议: {proposal}
你的底线: {bottom_line}

生成回复，可以:
1. 接受 (如果提议优于底线)
2. 讨价还价 (如果接近但不满足)
3. 拒绝 (如果差距过大)

回复不超过100字。
```

## 附录E: 版本规划

| 版本 | 内容 | 预计时间 |
|------|------|----------|
| **0.1 Alpha** | 核心生产系统 + 基础市场 | - |
| **0.2 Alpha** | AI对手 + 谈判系统 | - |
| **0.3 Beta** | 完整UI + 事件系统 | - |
| **0.4 Beta** | 科技系统 + 平衡调整 | - |
| **1.0 Release** | 完整游戏 | - |
| **1.1 DLC** | 废土生存扩展 | - |

---

**文档结束**

*Supply Chain Commander: Algo-City - Game Design Document v1.0*