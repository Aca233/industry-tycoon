# ä»·æ ¼èµ°åŠ¿å›¾é‡æ„æ–¹æ¡ˆ

## 1. é—®é¢˜è¯Šæ–­

### 1.1 å½“å‰æˆªå›¾é—®é¢˜åˆ†æ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä»·æ ¼èµ°åŠ¿                                      30åˆ† 1å°æ—¶ ... 1å¤© â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Â¥35.9                                                           â”‚
â”‚ Â¥35.8    â–         â–               â–                     â–          â”‚
â”‚ Â¥35.7 â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ Â¥35.6                                                           â”‚
â”‚    VOL                                                          â”‚
â”‚         D55.00h      D61.00h      D66.00h      D71.00h          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†‘ é—®é¢˜åŒºåŸŸ â†‘
```

| é—®é¢˜ | æè¿° | å½±å“ |
|------|------|------|
| **èœ¡çƒ›è¿‡å®½** | æ¯æ ¹Kçº¿å æ®å¤§é‡æ°´å¹³ç©ºé—´ | å›¾è¡¨ç¨€ç–ï¼Œä¿¡æ¯å¯†åº¦ä½ |
| **æ•°æ®è¿‡å°‘** | åªæ˜¾ç¤º15æ ¹Kçº¿ï¼ˆ1å¤©å‘¨æœŸï¼‰ | çœ‹ä¸åˆ°è¶‹åŠ¿ |
| **æ—¶é—´æ ¼å¼** | "D55.00h" æ ¼å¼æ™¦æ¶© | ç”¨æˆ·éš¾ä»¥ç†è§£ |
| **Yè½´èŒƒå›´** | 35.6-35.9 èŒƒå›´è¿‡çª„ | å¾®å°æ³¢åŠ¨è¢«è¿‡åº¦æ”¾å¤§ |
| **æ— å½±çº¿** | èœ¡çƒ›åªæœ‰å®ä½“ | ç¼ºå°‘é«˜ä½ç‚¹ä¿¡æ¯ |
| **é—´è·ä¸å‡** | Kçº¿ä¹‹é—´é—´è·ä¸ä¸€è‡´ | è§†è§‰æ··ä¹± |

### 1.2 æ ¹æœ¬åŸå› 

1. **æ•°æ®èšåˆç­–ç•¥é”™è¯¯**ï¼š1å¤©å‘¨æœŸåº”è¯¥æ˜¾ç¤ºæ›´å¤šå†å²æ•°æ®ï¼Œè€Œä¸æ˜¯åªæœ‰15æ ¹
2. **èœ¡çƒ›å®½åº¦è®¡ç®—**ï¼š`chartWidth / candleCount * 0.7` å½“æ•°æ®å°‘æ—¶èœ¡çƒ›è¿‡å®½
3. **æ—¶é—´æ ¼å¼åŒ–**ï¼šä½¿ç”¨ "D{day}.{hour}h" æ ¼å¼ä¸ç¬¦åˆç”¨æˆ·ä¹ æƒ¯
4. **æ— è§†å£ç®¡ç†**ï¼šæ²¡æœ‰å®ç°æ•°æ®çª—å£æ»‘åŠ¨

---

## 2. é‡æ„ç›®æ ‡

### 2.1 è§†è§‰ç›®æ ‡

```
ç†æƒ³çš„ K çº¿å›¾æ•ˆæœ:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”² MA VOL â”‚ 1H  3H  6H  12H [1D]               â”‚ 120/834      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Â¥36.20 â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚         â”‚    â”‚â•»â”‚                              â”‚               â”‚
â”‚ Â¥36.00 â”€â”¼â”€â”€â”€â”€â”ƒâ”ƒâ”ƒâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚         â”‚   â•»â”ƒâ”ƒâ”ƒâ•»    â•»â”‚â•»                     â•»â”ƒâ•»              â”‚
â”‚ Â¥35.80 â”€â”¼â”€â”€â”€â”ƒâ”ƒâ”ƒâ”ƒâ”ƒâ”€â”€â”€â”€â”ƒâ”ƒâ”ƒâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”ƒâ”ƒâ”ƒâ”€â”€â”€â”€â”€ â—€ Â¥35.7â”‚
â”‚         â”‚  â•»â”ƒâ”ƒâ”ƒâ”ƒâ”ƒ   â•»â”ƒâ”ƒâ”ƒâ•»    â•»â”‚â•» â•»â”‚â•» â•»â”‚â•»    â”ƒâ”ƒâ”ƒ              â”‚
â”‚ Â¥35.60 â”€â”¼â”€â”€â”ƒâ”ƒâ”ƒâ”ƒâ”ƒâ”ƒâ”€â”€â”€â”ƒâ”ƒâ”ƒâ”ƒâ”ƒâ”€â”€â”€â”€â”ƒâ”ƒâ”ƒâ”€â”ƒâ”ƒâ”ƒâ”€â”ƒâ”ƒâ”ƒâ”€â”€â”€â”€â”ƒâ”ƒâ”ƒâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚         â”‚  â•¹     â•¹   â•¹   â•¹    â•¹   â•¹   â•¹   â•¹  â•¹               â”‚
â”‚ Â¥35.40 â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚   VOL   â”‚ â–„â–ˆâ–„    â–„â–ˆâ–„  â–„â–„  â–„â–„  â–„â–„  â–„â–„  â–„â–„   â–„â–ˆâ–„               â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚        1/20    1/21    1/22    1/23    1/24   â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 åŠŸèƒ½ç›®æ ‡

| åŠŸèƒ½ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| æ™ºèƒ½èœ¡çƒ›å®½åº¦ | æ ¹æ®æ•°æ®å¯†åº¦è‡ªåŠ¨è°ƒæ•´ï¼Œä¿æŒæœ€ä½³è§†è§‰æ•ˆæœ | P0 |
| åˆç†æ•°æ®é‡ | ä¸åŒå‘¨æœŸæ˜¾ç¤ºåˆé€‚æ•°é‡çš„Kçº¿ | P0 |
| å‹å¥½æ—¶é—´æ ¼å¼ | "1/20 12:00" æˆ– "Day 55" æ ¼å¼ | P0 |
| ç¼©æ”¾æ‹–æ‹½ | é¼ æ ‡æ»šè½®ç¼©æ”¾ï¼Œæ‹–æ‹½ç§»åŠ¨è§†å£ | P1 |
| å½±çº¿ç»˜åˆ¶ | å®Œæ•´æ˜¾ç¤ºå¼€é«˜ä½æ”¶ | P1 |
| æŠ€æœ¯æŒ‡æ ‡ | MA5/MA10/BOLLç­‰ | P2 |
| å½“å‰ä»·æ ¼çº¿ | æ°´å¹³è™šçº¿æ ‡æ³¨å½“å‰ä»·æ ¼ | P2 |

---

## 3. æŠ€æœ¯æ–¹æ¡ˆ

### 3.1 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PriceChartCanvas (å®¹å™¨)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    ChartToolbar                          â”‚  â”‚
â”‚  â”‚  [Mode] [MA] [VOL] â”‚ [1H] [3H] [6H] [12H] [1D] â”‚ Stats   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    ChartCanvas (ä¸»ç»˜å›¾åŒº)                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚              PriceArea (ä»·æ ¼åŒº)                  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  - Yè½´åˆ»åº¦ (å·¦ä¾§)                               â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  - Kçº¿/æŠ˜çº¿                                     â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  - å‡çº¿å åŠ                                      â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  - å½“å‰ä»·æ ¼æ ‡ç­¾ (å³ä¾§)                          â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚              VolumeArea (æˆäº¤é‡åŒº)               â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚              XAxis (Xè½´æ—¶é—´åˆ»åº¦)                 â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    ChartTooltip (æ‚¬æµ®æç¤º)               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 è§†å£ç®¡ç†ç³»ç»Ÿ

```typescript
// æ–°å¢: è§†å£çŠ¶æ€ç®¡ç†
interface ChartViewport {
  // æ•°æ®èŒƒå›´
  startTick: number;      // è§†å£èµ·å§‹æ—¶é—´ç‚¹
  endTick: number;        // è§†å£ç»“æŸæ—¶é—´ç‚¹
  
  // ç¼©æ”¾
  zoomLevel: number;      // 1.0 = é»˜è®¤, 0.5 = æ”¾å¤§2å€, 2.0 = ç¼©å°2å€
  
  // è‡ªåŠ¨è°ƒæ•´
  autoScroll: boolean;    // æ˜¯å¦è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°æ•°æ®
}

// è§†å£æ“ä½œ
function zoomIn(viewport: ChartViewport, center: number): ChartViewport;
function zoomOut(viewport: ChartViewport, center: number): ChartViewport;
function pan(viewport: ChartViewport, deltaTicks: number): ChartViewport;
function scrollToLatest(viewport: ChartViewport, data: PriceData[]): ChartViewport;
```

### 3.3 èœ¡çƒ›å®½åº¦æ™ºèƒ½è®¡ç®—

```typescript
// é—®é¢˜: å½“å‰å®ç°
const rawCandleWidth = (chartWidth / candleData.length) * 0.7;
const candleWidth = Math.max(2, Math.min(20, rawCandleWidth));  // åªé™åˆ¶äº†èŒƒå›´

// è§£å†³æ–¹æ¡ˆ: æ™ºèƒ½å®½åº¦è®¡ç®—
function calculateOptimalCandleLayout(
  chartWidth: number,
  dataCount: number,
  minGap: number = 2,    // æœ€å°é—´è·
  minWidth: number = 4,  // æœ€å°èœ¡çƒ›å®½åº¦
  maxWidth: number = 16  // æœ€å¤§èœ¡çƒ›å®½åº¦
): { candleWidth: number; gap: number; offset: number } {
  
  // ç›®æ ‡: èœ¡çƒ›+é—´è· = å‡åŒ€åˆ†å¸ƒ
  const totalSlots = dataCount;
  const slotWidth = chartWidth / totalSlots;
  
  // èœ¡çƒ›å æ§½å®½çš„ 60-70%
  let candleWidth = slotWidth * 0.65;
  let gap = slotWidth * 0.35;
  
  // åº”ç”¨é™åˆ¶
  candleWidth = Math.max(minWidth, Math.min(maxWidth, candleWidth));
  gap = Math.max(minGap, (chartWidth - candleWidth * dataCount) / (dataCount - 1));
  
  // è®¡ç®—å±…ä¸­åç§»
  const totalUsed = candleWidth * dataCount + gap * (dataCount - 1);
  const offset = (chartWidth - totalUsed) / 2;
  
  return { candleWidth, gap, offset };
}
```

### 3.4 æ—¶é—´æ ¼å¼åŒ–æ”¹è¿›

```typescript
// å½“å‰é—®é¢˜: "D55.00h" æ ¼å¼
// è§£å†³æ–¹æ¡ˆ: æ™ºèƒ½æ ¼å¼åŒ–

function formatChartTime(tick: number, period: number, dataSpan: number): string {
  const day = Math.floor(tick / 24) + 1;
  const hour = tick % 24;
  
  // çŸ­å‘¨æœŸ (< 24h): æ˜¾ç¤º "12:00" æˆ– "D5 12:00"
  if (period <= 6) {
    if (dataSpan <= 24) {
      return `${hour.toString().padStart(2, '0')}:00`;
    }
    return `D${day} ${hour}:00`;
  }
  
  // ä¸­å‘¨æœŸ (12h-1d): æ˜¾ç¤º "1/20" æˆ– "D5"
  if (period <= 24) {
    return `D${day}`;
  }
  
  // é•¿å‘¨æœŸ (> 1d): æ˜¾ç¤º "Week 1" æˆ– "D1-D7"
  const weekNum = Math.floor((day - 1) / 7) + 1;
  return `W${weekNum}`;
}
```

### 3.5 Yè½´èŒƒå›´æ™ºèƒ½è®¡ç®—

```typescript
// é—®é¢˜: å½“å‰Yè½´èŒƒå›´è¿‡çª„ï¼Œæ”¾å¤§äº†å¾®å°æ³¢åŠ¨

function calculateYAxisRange(
  data: CandleData[],
  options: {
    minPaddingPercent: number;  // æœ€å°è¾¹è·ç™¾åˆ†æ¯” (å¦‚ 5%)
    minRangePercent: number;    // æœ€å°èŒƒå›´ç™¾åˆ†æ¯” (å¦‚ 10%)
    roundToNice: boolean;       // æ˜¯å¦åœ†æ•´åˆ°"å¥½çœ‹"çš„æ•°å­—
  }
): { min: number; max: number; step: number } {
  
  const prices = data.flatMap(d => [d.high, d.low]);
  const dataMin = Math.min(...prices);
  const dataMax = Math.max(...prices);
  
  // ç¡®ä¿æœ€å°èŒƒå›´
  const dataRange = dataMax - dataMin;
  const centerPrice = (dataMax + dataMin) / 2;
  const minRange = centerPrice * options.minRangePercent;
  
  const effectiveRange = Math.max(dataRange, minRange);
  const padding = effectiveRange * options.minPaddingPercent;
  
  let min = centerPrice - effectiveRange / 2 - padding;
  let max = centerPrice + effectiveRange / 2 + padding;
  
  // åœ†æ•´åˆ°"å¥½çœ‹"çš„æ•°å­—
  if (options.roundToNice) {
    const step = calculateNiceStep(max - min, 5);
    min = Math.floor(min / step) * step;
    max = Math.ceil(max / step) * step;
    return { min, max, step };
  }
  
  return { min, max, step: (max - min) / 5 };
}

function calculateNiceStep(range: number, targetTicks: number): number {
  const roughStep = range / targetTicks;
  const magnitude = Math.pow(10, Math.floor(Math.log10(roughStep)));
  const normalized = roughStep / magnitude;
  
  let niceStep: number;
  if (normalized <= 1) niceStep = 1;
  else if (normalized <= 2) niceStep = 2;
  else if (normalized <= 5) niceStep = 5;
  else niceStep = 10;
  
  return niceStep * magnitude;
}
```

### 3.6 Kçº¿ç»˜åˆ¶æ”¹è¿›

```typescript
// æ”¹è¿›åçš„èœ¡çƒ›ç»˜åˆ¶å‡½æ•°
function drawProfessionalCandle(
  ctx: CanvasRenderingContext2D,
  x: number,              // èœ¡çƒ›ä¸­å¿ƒXåæ ‡
  candleWidth: number,
  open: number,           // Yåæ ‡
  high: number,           // Yåæ ‡
  low: number,            // Yåæ ‡
  close: number,          // Yåæ ‡
  isUp: boolean,
  colors: { up: string; down: string; wick: string }
): void {
  const color = isUp ? colors.up : colors.down;
  const bodyLeft = x - candleWidth / 2;
  const bodyTop = Math.min(open, close);
  const bodyBottom = Math.max(open, close);
  const bodyHeight = Math.max(1, bodyBottom - bodyTop);
  
  // 1. ç»˜åˆ¶å½±çº¿ (wick/shadow)
  ctx.strokeStyle = colors.wick || color;
  ctx.lineWidth = Math.max(1, candleWidth * 0.1);
  ctx.beginPath();
  // ä¸Šå½±çº¿
  ctx.moveTo(x, high);
  ctx.lineTo(x, bodyTop);
  // ä¸‹å½±çº¿
  ctx.moveTo(x, bodyBottom);
  ctx.lineTo(x, low);
  ctx.stroke();
  
  // 2. ç»˜åˆ¶å®ä½“
  ctx.fillStyle = color;
  
  // åœ†è§’çŸ©å½¢å®ä½“ (æ›´ç¾è§‚)
  const radius = Math.min(2, candleWidth * 0.15);
  ctx.beginPath();
  ctx.roundRect(bodyLeft, bodyTop, candleWidth, bodyHeight, radius);
  ctx.fill();
  
  // 3. é˜³çº¿ç©ºå¿ƒæ•ˆæœ (å¯é€‰)
  if (isUp && candleWidth > 6) {
    ctx.strokeStyle = color;
    ctx.lineWidth = 1;
    ctx.stroke();
    ctx.fillStyle = '#0f172a';  // èƒŒæ™¯è‰²å¡«å……
    ctx.beginPath();
    ctx.roundRect(bodyLeft + 1, bodyTop + 1, candleWidth - 2, bodyHeight - 2, radius - 1);
    ctx.fill();
  }
}
```

---

## 4. æ•°æ®å‘¨æœŸç­–ç•¥

### 4.1 å‘¨æœŸ-æ•°æ®é‡å¯¹ç…§è¡¨

| å‘¨æœŸ | Kçº¿æ—¶é—´è·¨åº¦ | å»ºè®®æ˜¾ç¤ºæ•°é‡ | å®é™…æ—¶é—´è·¨åº¦ |
|------|------------|--------------|--------------|
| 30åˆ† | 0.5h/æ ¹ | 200æ ¹ | 100å°æ—¶ (4å¤©) |
| 1å°æ—¶ | 1h/æ ¹ | 168æ ¹ | 168å°æ—¶ (7å¤©) |
| 3å°æ—¶ | 3h/æ ¹ | 120æ ¹ | 360å°æ—¶ (15å¤©) |
| 6å°æ—¶ | 6h/æ ¹ | 80æ ¹ | 480å°æ—¶ (20å¤©) |
| 12å°æ—¶ | 12h/æ ¹ | 60æ ¹ | 720å°æ—¶ (30å¤©) |
| 1å¤© | 24h/æ ¹ | 90æ ¹ | 2160å°æ—¶ (90å¤©) |

### 4.2 æ•°æ®èšåˆé€»è¾‘

```typescript
interface AggregationConfig {
  period: number;          // èšåˆå‘¨æœŸ (ticks)
  maxCandles: number;      // æœ€å¤§æ˜¾ç¤ºæ•°é‡
  minDataPoints: number;   // æœ€å°‘éœ€è¦å¤šå°‘åŸå§‹æ•°æ®ç‚¹
}

const AGGREGATION_CONFIGS: Record<string, AggregationConfig> = {
  '30m': { period: 1, maxCandles: 200, minDataPoints: 2 },
  '1h':  { period: 1, maxCandles: 168, minDataPoints: 2 },
  '3h':  { period: 3, maxCandles: 120, minDataPoints: 10 },
  '6h':  { period: 6, maxCandles: 80, minDataPoints: 20 },
  '12h': { period: 12, maxCandles: 60, minDataPoints: 40 },
  '1d':  { period: 24, maxCandles: 90, minDataPoints: 80 },
};
```

---

## 5. äº¤äº’åŠŸèƒ½è®¾è®¡

### 5.1 ç¼©æ”¾äº¤äº’

```typescript
// é¼ æ ‡æ»šè½®ç¼©æ”¾
function handleWheel(e: WheelEvent, viewport: ChartViewport): ChartViewport {
  e.preventDefault();
  
  const zoomFactor = e.deltaY > 0 ? 1.1 : 0.9;  // æ»šåŠ¨æ–¹å‘å†³å®šæ”¾å¤§/ç¼©å°
  const mouseX = e.offsetX;
  
  // è®¡ç®—é¼ æ ‡ä½ç½®å¯¹åº”çš„æ•°æ®æ—¶é—´ç‚¹
  const chartArea = getChartArea();
  const ratio = (mouseX - chartArea.left) / chartArea.width;
  const centerTick = viewport.startTick + ratio * (viewport.endTick - viewport.startTick);
  
  // ä»¥é¼ æ ‡ä½ç½®ä¸ºä¸­å¿ƒç¼©æ”¾
  const newRange = (viewport.endTick - viewport.startTick) * zoomFactor;
  const newStart = centerTick - newRange * ratio;
  const newEnd = centerTick + newRange * (1 - ratio);
  
  return {
    ...viewport,
    startTick: Math.max(0, newStart),
    endTick: newEnd,
    autoScroll: false,  // ç”¨æˆ·æ“ä½œåç¦ç”¨è‡ªåŠ¨æ»šåŠ¨
  };
}
```

### 5.2 æ‹–æ‹½å¹³ç§»

```typescript
// æ‹–æ‹½å¹³ç§»
function handleDrag(
  startX: number,
  currentX: number,
  viewport: ChartViewport,
  chartWidth: number
): ChartViewport {
  const deltaPixels = currentX - startX;
  const ticksPerPixel = (viewport.endTick - viewport.startTick) / chartWidth;
  const deltaTicks = -deltaPixels * ticksPerPixel;  // åå‘ï¼šå‘å³æ‹–åŠ¨çœ‹æ›´æ—©çš„æ•°æ®
  
  return {
    ...viewport,
    startTick: viewport.startTick + deltaTicks,
    endTick: viewport.endTick + deltaTicks,
    autoScroll: false,
  };
}
```

### 5.3 åŒå‡»é‡ç½®

```typescript
function handleDoubleClick(data: PriceData[], period: number): ChartViewport {
  // é‡ç½®åˆ°æ˜¾ç¤ºæœ€è¿‘æ•°æ®
  const config = AGGREGATION_CONFIGS[getConfigKey(period)];
  const totalTicks = data.length;
  
  return {
    startTick: Math.max(0, totalTicks - config.maxCandles * period),
    endTick: totalTicks,
    autoScroll: true,
    zoomLevel: 1.0,
  };
}
```

---

## 6. å®ç°æ­¥éª¤

### Phase 1: æ ¸å¿ƒä¿®å¤ (ç«‹å³)
1. **ä¿®å¤èœ¡çƒ›å®½åº¦è®¡ç®—** - ä½¿ç”¨æ™ºèƒ½å¸ƒå±€ç®—æ³•
2. **ä¿®å¤æ•°æ®é‡é—®é¢˜** - æ ¹æ®å‘¨æœŸæ˜¾ç¤ºåˆé€‚æ•°é‡çš„Kçº¿
3. **ä¿®å¤æ—¶é—´æ ¼å¼** - ä½¿ç”¨å‹å¥½çš„æ—¶é—´æ˜¾ç¤º

### Phase 2: è§†è§‰å¢å¼º (çŸ­æœŸ)
4. **æ”¹è¿›èœ¡çƒ›ç»˜åˆ¶** - æ·»åŠ å½±çº¿ã€åœ†è§’ã€ç©ºå¿ƒé˜³çº¿
5. **ä¼˜åŒ–Yè½´èŒƒå›´** - æ™ºèƒ½è®¡ç®—ï¼Œé¿å…è¿‡åº¦æ”¾å¤§
6. **æ·»åŠ å½“å‰ä»·æ ¼çº¿** - æ°´å¹³è™šçº¿æ ‡æ³¨

### Phase 3: äº¤äº’å¢å¼º (ä¸­æœŸ)
7. **å®ç°ç¼©æ”¾åŠŸèƒ½** - é¼ æ ‡æ»šè½®ç¼©æ”¾
8. **å®ç°æ‹–æ‹½åŠŸèƒ½** - æ‹–æ‹½å¹³ç§»å†å²æ•°æ®
9. **å®ç°è§†å£ç®¡ç†** - çŠ¶æ€ä¿æŒã€è‡ªåŠ¨æ»šåŠ¨

### Phase 4: é«˜çº§åŠŸèƒ½ (åæœŸ)
10. **æŠ€æœ¯æŒ‡æ ‡** - BOLLé€šé“ã€MACDç­‰
11. **è¶‹åŠ¿æ ‡æ³¨** - æ”¯æ’‘/é˜»åŠ›ä½
12. **æ€§èƒ½ä¼˜åŒ–** - å¤§æ•°æ®é‡æ¸²æŸ“ä¼˜åŒ–

---

## 7. ä»£ç å˜æ›´æ¸…å•

| æ–‡ä»¶ | å˜æ›´ç±»å‹ | è¯´æ˜ |
|------|----------|------|
| `InteractiveChart.tsx` | é‡æ„ | æ ¸å¿ƒå›¾è¡¨ç»„ä»¶ |
| `utils.ts` | ä¿®æ”¹ | æ·»åŠ æ™ºèƒ½å¸ƒå±€å‡½æ•° |
| `types.ts` | ä¿®æ”¹ | æ·»åŠ è§†å£ç±»å‹ |
| `useChartViewport.ts` | æ–°å¢ | è§†å£ç®¡ç†Hook |
| `ChartToolbar.tsx` | æ–°å¢ | å·¥å…·æ ç»„ä»¶ |

---

## 8. é¢„æœŸæ•ˆæœå¯¹æ¯”

### Before (å½“å‰)
- âŒ 15æ ¹è¶…å®½Kçº¿ï¼Œç¨€ç–åˆ†å¸ƒ
- âŒ "D55.00h" æ™¦æ¶©æ—¶é—´æ ¼å¼
- âŒ æ— ç¼©æ”¾/æ‹–æ‹½
- âŒ Yè½´èŒƒå›´è¿‡çª„

### After (é‡æ„å)
- âœ… 90æ ¹é€‚ä¸­å®½åº¦Kçº¿ï¼Œå¯†é›†åˆ†å¸ƒ
- âœ… "D55" æˆ– "1/20" å‹å¥½æ ¼å¼
- âœ… æ»šè½®ç¼©æ”¾ + æ‹–æ‹½å¹³ç§»
- âœ… æ™ºèƒ½Yè½´èŒƒå›´ï¼Œé¿å…è¿‡åº¦æ”¾å¤§
- âœ… å®Œæ•´å½±çº¿ã€åœ†è§’èœ¡çƒ›
- âœ… å½“å‰ä»·æ ¼æ°´å¹³çº¿æ ‡æ³¨